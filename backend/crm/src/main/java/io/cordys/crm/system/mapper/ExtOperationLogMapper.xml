<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.cordys.crm.system.mapper.ExtOperationLogMapper">

    <select id="list" parameterType="io.cordys.crm.system.dto.request.OperationLogRequest" resultType="io.cordys.crm.system.dto.response.OperationLogResponse">
        SELECT
            t.id,
            t.organization_id,
            t.type,
            t.module,
            t.create_time,
            t.create_user as operator,
            t.resource_name
        FROM
        sys_operation_log t
        where t.organization_id = #{orgId}
            <if test="request.operator != null and request.operator != ''">
                AND t.create_user = #{request.operUser, jdbcType=VARCHAR}
            </if>
            <if test="request.startTime != null and request.endTime != null">
                AND t.create_time BETWEEN #{request.startTime} AND #{request.endTime}
            </if>
            <if test="request.type != null and request.type != ''">
                AND t.type = #{request.type}
            </if>
            <if test="request.module != null and request.module != ''">
                <bind name="module" value="request.module+'%'"/>
                AND t.module like #{module}
            </if>
        ORDER BY t.create_time DESC
    </select>

</mapper>